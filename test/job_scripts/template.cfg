process analyze = 
{
  
untracked PSet maxEvents = {untracked int32 input = NEVENT} 
 
service = MessageLogger {

   untracked vstring destinations = { "LA_debug_FILETAG_NUMBER" }
   
    untracked PSet debug = { untracked string threshold = "ERROR"    } 
#    untracked PSet cout = { untracked string threshold = "DEBUG"    } 
#    untracked vstring debugModules =  { "read" , "sistripLAProfile" }
              		              
  }
  
 
  source = PoolSource
    {	  
          untracked vstring fileNames = 
     	       {
	          # Minbias CSA08
		                
               "rfio:/castor/cern.ch/cmsFILENAME"
              
	       }
     	   
    }
    
  include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
  include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

  #Reconstruction
  include "Configuration/StandardSequences/data/Reconstruction.cff"
  
  #FakeConditions
  #include "Configuration/StandardSequences/data/FakeConditions.cff"
  include "Configuration/StandardSequences/data/FrontierConditions_GlobalTag.cff"
  replace GlobalTag.globaltag = "1PB_V2_RECO::All"

  es_source trackerAlignment = PoolDBESSource {
       using CondDBSetup
       string connect =  "frontier://FrontierProd/CMS_COND_20X_ALIGNMENT"  
       VPSet toGet = {
            { string record = "TrackerAlignmentRcd" string tag  = "TrackerAlignedGeometry200_s156_mc" }
        }
   }

  es_prefer trackerAlignment = PoolDBESSource {}
  
  es_source trackerAlignmentError = PoolDBESSource {
       using CondDBSetup
       string connect =  "frontier://FrontierProd/CMS_COND_20X_ALIGNMENT"  
       VPSet toGet = {
            { string record = "TrackerAlignmentErrorRcd" string tag = "TrackerIdealGeometryErrors200_v2" }
        }
   }

  es_prefer trackerAlignmentError = PoolDBESSource {}
  
  #Refitter
  include "RecoTracker/TrackProducer/data/RefitterWithMaterial.cff"
  
  module trackrefitter = TrackRefitter 
 {
   string Fitter = "FittingSmootherRK"   
 
   string Propagator = "RungeKuttaTrackerPropagator"
 
   #InputTag src = generalTracks
   InputTag src = ALCARECOSiStripCalMinBias
   InputTag beamSpot      = offlineBeamSpot
   string TTRHBuilder = "WithTrackAngle"
   bool TrajectoryInEvent = true
   string constraint = ""
   string AlgorithmName = "ctf"
   bool useHitsSplitting = false
 }
          
  #service = DaqMonitorROOTBackEnd{}
  include "DQMServices/Core/data/DQM.cfg"
  replace DQM.collectorHost = ""

  #DQM
#  include "DQM/SiStripMonitorClient/data/SiStripDQMOffline.cff"

  
  #SiStripLAProfileBooker
  
  include "CalibTracker/SiStripLorentzAngle/data/SiStripLAProfileBooker.cfi"  
  replace sistripLAProfile.Tracks = "trackrefitter"
  replace sistripLAProfile.TIB_bin = 120
  replace sistripLAProfile.TOB_bin = 120
  replace sistripLAProfile.SUM_bin = 120 
  replace sistripLAProfile.Fit_Result = false
  replace sistripLAProfile.fileName = "file:MY_TMP/LA_Histos_FILETAG_NUMBER.root"
  replace sistripLAProfile.treeName = "file:MY_TMP/LA_Trees_FILETAG_NUMBER.root"
  replace sistripLAProfile.fitName = "file:MY_TMP/Fit_FILETAG_NUMBER"
    
  path recotracks = {trackrefitter}
  path LorentzAngle = {sistripLAProfile}
#  path dqm = {SiStripDQMOffSimData}
 	
  schedule = {recotracks, LorentzAngle}
  
  module print = AsciiOutputModule {}
  endpath ep = { print }
   
}
